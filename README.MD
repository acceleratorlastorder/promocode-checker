# Promocode API

## üìä Synth√®se du projet ¬´ Promocode API ¬ª

### ‚è±Ô∏è Temps investi

- **‚âà 8 heures** de d√©veloppement.

### üõ†Ô∏è Outils et m√©thodologie

- **Cursor** pour acc√©l√©rer le dev (savoir maitriser l'IA est important en tant que dev).
- **IA (ChatGPT)** pour g√©n√©rer du code, avec un regard plus cibl√© et critique pour √©tailler les propositions.

> Pour l‚Äôinstallation, merci de vous r√©f√©rer au fichier [INSTALLATION.MD](./INSTALLATION.MD).

---

## üöÄ Am√©liorations propos√©es

1. **Protection brute-force (Lot 1)**

    - Int√©grer **fail2ban** en production pour bloquer les `404` sur `/promocodes/validate`.
    - Seuil sugg√©r√© : \~ 10 tentatives/s avant bannissement.

2. **Gestion des tokens (Lot 1)**

    - Ajouter **Keycloak** pour l‚Äôauthentification OAuth2/JWT.
    - √Ä planifier comme premier incr√©ment formel (Lot 1).

3. **Internationalisation & ressources (Lot 1)**

    - Mettre en place un syst√®me i18n cl√©/valeur pour les messages.
    - Le frontend r√©sout dynamiquement selon la langue de l‚Äôutilisateur.

4. **Configuration dynamique (Lot 1)**

    - Exposer davantage de variables d‚Äôenvironnement (timeouts, seuils, URLs‚Ä¶) pour que les **SRE/DevOps** ajustent sans redeploy.

5. **Rate-limiting application-side (Lot 1)**

    - Utiliser **@fastify/rate-limit** par utilisateur ou cl√© API.
    - Conserver **Nginx** + **fail2ban** pour rafales ou attaques r√©seau.

6. **Cache Redis pour OpenWeatherMap (Lot 1-2)**

    - Remplacer le cache en m√©moire par **Redis** pour persistance et partage inter-instances.

7. **UI pour json-rules-engine (Lot 2)**

    - Int√©grer l‚Äô√©diteur visuel de r√®gles m√©tier : [json-rule-editor](https://github.com/vinzdeveloper/json-rule-editor).

8. **Erreurs plus claires (Lot 1)**

    - Normaliser le format de r√©ponse en cas de refus :

        ```json
        {
            "promocode_name": "TEST666",
            "status": "denied",
            "reasons": [
                "Condition for 'age' was not met: expected 25 to be equal 666",
                "Condition for 'weather' was not met: expected undefined to be equal \"clear\" (on path: $.is)",
                "Condition for 'weather' was not met: expected undefined to be greaterThan 15 (on path: $.temp)"
            ]
        }
        ```

---

## üìÖ Roadmap sugg√©r√©e

| Lot   | Contenu principal                                                    |
| ----- | -------------------------------------------------------------------- |
| **0** | Base fonctionnelle de l‚ÄôAPI (code actuel)                            |
| **1** | Auth (Keycloak), rate-limit, fail2ban, i18n, config dynamique        |
| **2** | Cache Redis, √©diteur UI pour r√®gles                                  |
| **3** | Image Docker distroless pour une empreinte r√©duite et plus s√©curis√©e |

---
